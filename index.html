<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Raheim’s Classroom – Live Notes</title>
<style>
:root {
  --primary:#2563eb;
  --bg:#f7f9fc;
  --card:#fff;
  --note:#eef2ff;
  --raise:#fff3cd;
  --txt:#333;
  --radius:10px;
}
body {
  font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
  margin:0;
  background:var(--bg);
  color:var(--txt);
}
header {background:var(--primary);color:#fff;text-align:center;padding:15px;}
main{max-width:1100px;margin:20px auto;padding:0 16px;}
.card{background:var(--card);padding:16px;border-radius:var(--radius);box-shadow:0 4px 10px rgba(0,0,0,0.1);margin-bottom:20px;}
input,textarea,button{font:inherit;}
input,textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box;margin-top:8px;}
button{background:var(--primary);color:#fff;border:none;padding:10px 14px;border-radius:6px;cursor:pointer;margin-top:8px;}
button:disabled{background:#aaa;cursor:not-allowed;}
.chat{background:#f0f2f5;padding:12px;border-radius:8px;height:300px;overflow-y:auto;border:1px solid #ddd;}
.noteArea{background:var(--note);padding:12px;border-radius:8px;min-height:200px;white-space:pre-wrap;}
.button-row{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px;}
.avatar-btn{padding:6px 8px;margin:2px;font-size:1.3em;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer;}
.avatar-btn.selected{border:2px solid var(--primary);}
.symbol-button{padding:4px 6px;margin:3px;background:#6c757d;color:#fff;border:none;border-radius:4px;cursor:pointer;}
.raise{background:var(--raise);padding:8px;border-radius:6px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;}
</style>

<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>
</head>
<body>
<header><h1>Raheim’s Classroom – Live Notes</h1></header>

<main>
<!-- LOGIN -->
<div id="loginCard" class="card">
  <h2>Join Class</h2>
  <div class="button-row">
    <button onclick="chooseRole('teacher')">I’m a Teacher 👨‍🏫</button>
    <button onclick="chooseRole('student')">I’m a Student 🎓</button>
  </div>

  <div id="teacherPanel" style="display:none">
    <p>Teacher Code:</p>
    <input type="password" id="teacherCode" placeholder="Enter code">
    <p>Choose avatar:</p>
    <div id="teacherAvatars" class="button-row"></div>
    <button onclick="loginTeacher()">Enter</button>
  </div>

  <div id="studentPanel" style="display:none">
    <p>Your Name:</p>
    <input id="studentName" placeholder="Your name">
    <p>Choose avatar:</p>
    <div id="studentAvatars" class="button-row"></div>
    <button onclick="loginStudent()">Join</button>
  </div>
</div>

<!-- MAIN AREA -->
<div id="mainArea" style="display:none">
  <div id="notesCard" class="card">
    <h3>Live Note Board</h3>
    <div id="liveNote" class="noteArea" contenteditable="false"></div>
    <div id="symbolButtons" class="button-row"></div>
    <button id="clearNoteBtn" style="display:none;background:#dc3545;">Clear Notes</button>
  </div>

  <div class="card">
    <h3>Class Chat</h3>
    <div id="chatBox" class="chat"></div>
    <input id="chatInput" placeholder="Type message...">
    <div class="button-row">
      <button id="sendChatBtn">Send 💬</button>
      <button id="clearChatBtn" style="display:none;background:#dc3545;">Clear Chat</button>
    </div>
  </div>

  <div class="card">
    <h3>Raise Hand ✋</h3>
    <button id="raiseBtn">Raise Hand</button>
    <div id="raiseList"></div>
    <button id="clearRaiseBtn" style="display:none;background:#ffc107;color:#000;">Clear Raises</button>
  </div>
</div>
</main>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyCjivsTeBcbr-UnnkfMbIYX7_9Wxya5U04",
  authDomain:"raheim-s-class.firebaseapp.com",
  databaseURL:"https://raheim-s-class-default-rtdb.firebaseio.com",
  projectId:"raheim-s-class",
  storageBucket:"raheim-s-class.appspot.com",
  messagingSenderId:"576992270609",
  appId:"1:576992270609:web:7441555f9299b8d42bd4b0"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let role=null, name=null, avatar=null;
const TEACHER_CODE="raheimp100classstarts";
const mathSymbols=['π','√','∞','∑','÷','≠','≈','θ','Δ','α','β','γ','±','∫','≤','≥'];
const teacherAvatars=['👩‍🏫','👨‍🏫','🧑‍🏫'];
const studentAvatars=['😀','😎','🤓','🧐','🥳','🤩','😇','😜','😏','😺'];

function chooseRole(r){
  role=r;
  document.getElementById('teacherPanel').style.display=r==='teacher'?'block':'none';
  document.getElementById('studentPanel').style.display=r==='student'?'block':'none';
}
function buildAvatars(){
  const tDiv=document.getElementById('teacherAvatars');
  const sDiv=document.getElementById('studentAvatars');
  teacherAvatars.forEach(a=>{
    const b=document.createElement('button');
    b.className='avatar-btn';b.textContent=a;
    b.onclick=()=>{avatar=a;highlight(tDiv,b)};
    tDiv.appendChild(b);
  });
  studentAvatars.forEach(a=>{
    const b=document.createElement('button');
    b.className='avatar-btn';b.textContent=a;
    b.onclick=()=>{avatar=a;highlight(sDiv,b)};
    sDiv.appendChild(b);
  });
}
function highlight(parent,el){
  parent.querySelectorAll('button').forEach(b=>b.classList.remove('selected'));
  el.classList.add('selected');
}
buildAvatars();

// symbol buttons
const symDiv=document.getElementById('symbolButtons');
mathSymbols.forEach(s=>{
  const b=document.createElement('button');
  b.textContent=s;b.className='symbol-button';
  b.onclick=()=>insertSymbol(s);
  symDiv.appendChild(b);
});
function insertSymbol(s){
  const live=document.getElementById('liveNote');
  if(role==='teacher'){
    const sel=window.getSelection();
    const range=sel.getRangeAt(0);
    range.insertNode(document.createTextNode(s));
    updateNote();
  }
}

function loginTeacher(){
  const code=document.getElementById('teacherCode').value.trim();
  if(code!==TEACHER_CODE){alert("Wrong code");return;}
  if(!avatar){alert("Pick avatar");return;}
  name="Teacher";
  startClass('teacher');
}
function loginStudent(){
  const n=document.getElementById('studentName').value.trim();
  if(!n){alert("Enter your name");return;}
  if(!avatar){alert("Pick avatar");return;}
  name=n;
  startClass('student');
}

function startClass(r){
  role=r;
  document.getElementById('loginCard').style.display='none';
  document.getElementById('mainArea').style.display='block';
  if(r==='teacher'){
    document.getElementById('liveNote').contentEditable=true;
    document.getElementById('clearNoteBtn').style.display='inline-block';
    document.getElementById('clearChatBtn').style.display='inline-block';
    document.getElementById('clearRaiseBtn').style.display='inline-block';
  } else {
    document.getElementById('liveNote').contentEditable=false;
  }
  initNote();
  initChat();
  initRaise();
}

// --- LIVE NOTES ---
function initNote(){
  const noteRef=db.ref('liveNote/content');
  const live=document.getElementById('liveNote');
  if(role==='teacher'){
    live.addEventListener('input',()=>updateNote());
    document.getElementById('clearNoteBtn').onclick=()=>{if(confirm("Clear notes?"))noteRef.set('');};
  }
  noteRef.on('value',snap=>{
    if(role!=='teacher'){
      live.textContent=snap.val()||'';
    }
  });
}
function updateNote(){
  const live=document.getElementById('liveNote');
  db.ref('liveNote/content').set(live.textContent);
}

// --- CHAT ---
function initChat(){
  const chatRef=db.ref('chat');
  const box=document.getElementById('chatBox');
  chatRef.on('child_added',snap=>{
    const d=snap.val();
    const div=document.createElement('div');
    div.textContent=`${d.avatar} ${d.name}: ${d.text}`;
    box.appendChild(div);
    box.scrollTop=box.scrollHeight;
  });
  document.getElementById('sendChatBtn').onclick=()=>{
    const msg=document.getElementById('chatInput').value.trim();
    if(!msg)return;
    chatRef.push({name:name,avatar:avatar,text:msg,time:Date.now()});
    document.getElementById('chatInput').value='';
  };
  document.getElementById('clearChatBtn').onclick=()=>{if(confirm("Clear chat?"))chatRef.remove();};
}

// --- RAISE HAND ---
function initRaise(){
  const raiseRef=db.ref('raises');
  const list=document.getElementById('raiseList');
  raiseRef.on('value',snap=>{
    const d=snap.val()||{};
    list.innerHTML='';
    Object.keys(d).forEach(k=>{
      const r=d[k];
      const div=document.createElement('div');div.className='raise';
      div.textContent=`${r.avatar} ${r.name}`;
      if(role==='teacher'){
        const b=document.createElement('button');b.textContent='Acknowledge';
        b.onclick=()=>raiseRef.child(k).remove();
        div.appendChild(b);
      }
      list.appendChild(div);
    });
  });
  document.getElementById('raiseBtn').onclick=()=>{
    const key=name.replace(/[.#$/\[\]]/g,'_');
    raiseRef.child(key).get().then(s=>{
      if(s.exists())raiseRef.child(key).remove();
      else raiseRef.child(key).set({name,avatar,time:Date.now()});
    });
  };
  document.getElementById('clearRaiseBtn').onclick=()=>{if(confirm("Clear raises?"))raiseRef.remove();};
}
</script>
</body>
</html>
