<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸ““ Live Class Notes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body{font-family:'Segoe UI',sans-serif;margin:0;background:#f0f4f8;color:#333;display:flex;flex-direction:column;height:100vh;}
header{background:#1f2d3d;color:#fff;padding:16px 20px;display:flex;justify-content:space-between;align-items:center;}
header .title{font-size:20px;font-weight:bold;}
.container{flex:1;display:flex;flex-direction:column;}
.mainContent{flex:1;display:flex;}

/* Toolbar */
#toolbar{display:none;flex-direction:column;gap:6px;background:#e0e7ff;padding:10px;border-right:2px solid #c7d2fe;min-width:80px;overflow-y:auto;}
#toolbar button{background:#4f46e5;color:#fff;border:none;padding:6px;border-radius:6px;cursor:pointer;font-size:18px;}
#toolbar button:hover{background:#3730a3;}
#btnClear{background:#ef4444;}
#editor{flex:1;background:#fff;padding:18px;min-height:300px;font-size:20px;line-height:1.6;white-space:pre-wrap;overflow-y:auto;}

/* Reactions */
#reactions{border-top:1px solid #ccc;padding:10px;background:#fff;display:flex;gap:10px;font-size:22px;}
#reactions button{background:none;border:none;cursor:pointer;}
#reactionCounts{margin-top:5px;font-size:16px;}

/* Raise Hand + Permissions */
#raiseHand{margin:8px 0;padding:8px 12px;background:#f59e0b;color:white;border:none;border-radius:6px;cursor:pointer;}
#raiseHand:hover{background:#d97706;}
#raisedList, #permissionList{font-size:14px;margin-top:5px;color:#111;display:flex;flex-direction:column;gap:6px;}
#raisedList div, #permissionList div{display:flex;gap:6px;align-items:center;}
#raisedList button, #permissionList button{padding:4px 6px;border:none;border-radius:6px;cursor:pointer;font-size:13px;}
.allowBtn{background:#10b981;color:white;}
.declineBtn{background:#ef4444;color:white;}
.revokeBtn{background:#6b7280;color:white;}
#clearHandsBtn, #revokeAllBtn{display:none;margin-top:6px;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;}
#clearHandsBtn{background:#ef4444;color:white;}
#revokeAllBtn{background:#6b7280;color:white;}
#yourPermission{margin-top:6px;font-size:14px;color:green;font-weight:bold;}

/* Chat */
#chatBox{border-top:2px solid #ccc;background:#fff;padding:10px;height:200px;overflow-y:auto;font-size:16px;}
#chatInput{display:none;gap:8px;padding:8px;background:#e5e7eb;align-items:center;}
#chatInput input{flex:1;padding:10px;font-size:16px;border:1px solid #ccc;border-radius:6px;}
#chatInput button{background:#4f46e5;color:white;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;}
#chatInput button:hover{background:#3730a3;}
#clearChat{background:#ef4444 !important;}

/* Emoji picker */
#emojiPicker{display:none;position:absolute;bottom:70px;right:20px;background:#fff;border:1px solid #ccc;padding:10px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.2);max-width:250px;flex-wrap:wrap;z-index:1000;}
#emojiPicker button{font-size:20px;margin:4px;border:none;background:transparent;cursor:pointer;}

/* Modal */
#roleModal{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:999;}
.modalCard{background:#fff;padding:20px;border-radius:12px;max-width:400px;width:90%;}
.row{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;}
</style>
</head>
<body>

<header>
Â  <div class="title">ğŸ““ Live Class Notes</div>
Â  <div>
Â  Â  <button id="toggleToolbar" style="display:none;background:#10b981;color:#fff;">â˜° Tools</button>
Â  </div>
</header>

<div class="container">
Â  <div class="mainContent">
Â  Â  <div id="toolbar">
Â  Â  Â  <button data-symbol="+">+</button>
Â  Â  Â  <button data-symbol="âˆ’">âˆ’</button>
Â  Â  Â  <button data-symbol="Ã—">Ã—</button>
Â  Â  Â  <button data-symbol="Ã·">Ã·</button>
Â  Â  Â  <button data-symbol="=">=</button>
Â  Â  Â  <button data-symbol="âˆš">âˆš</button>
Â  Â  Â  <button data-symbol="Ï€">Ï€</button>
Â  Â  Â  <button id="btnClear">ğŸ—‘</button>
Â  Â  </div>
Â  Â  <div style="flex:1;display:flex;flex-direction:column;">
Â  Â  Â  <div id="editor" contenteditable="false"><p style="color:#888;">Waiting for teacher...</p></div>
Â  Â  Â  <div id="reactions">
Â  Â  Â  Â  <button data-emoji="ğŸ‘">ğŸ‘</button>
Â  Â  Â  Â  <button data-emoji="ğŸ”¥">ğŸ”¥</button>
Â  Â  Â  Â  <button data-emoji="â­">â­</button>
Â  Â  Â  </div>
Â  Â  Â  <div id="reactionCounts"></div>
Â  Â  Â  <button id="raiseHand">ğŸ– Raise Hand</button>
Â  Â  Â  <h4>Raised Hands:</h4>
Â  Â  Â  <div id="raisedList"></div>
Â  Â  Â  <button id="clearHandsBtn">Clear Raised Hands</button>
Â  Â  Â  <h4>Current Permissions:</h4>
Â  Â  Â  <div id="permissionList"></div>
Â  Â  Â  <button id="revokeAllBtn">Revoke All Permissions</button>
Â  Â  Â  <div id="yourPermission"></div>
Â  Â  </div>
Â  </div>
Â  <div id="chatBox"></div>
Â  <div id="chatInput">
Â  Â  <input type="text" id="chatMessage" placeholder="Type a message..."Â 
Â  Â  Â  autocorrect="off" autocomplete="off" spellcheck="false">
Â  Â  <button id="emojiBtn">ğŸ˜Š</button>
Â  Â  <button id="sendChat">Send</button>
Â  Â  <button id="clearChat" style="display:none;">Clear</button>
Â  </div>
</div>

<div id="emojiPicker"></div>

<div id="roleModal">
Â  <div class="modalCard">
Â  Â  <h3>Select role</h3>
Â  Â  <div class="row">
Â  Â  Â  <button id="btnTeacher">Teacher</button>
Â  Â  Â  <button id="btnStudent" class="ghost">Student</button>
Â  Â  </div>
Â  Â  <div id="pwBlock" style="display:none;margin-top:12px">
Â  Â  Â  <label>Password:</label>
Â  Â  Â  <input type="password" id="pwInput" placeholder="Enter password">
Â  Â  Â  <div class="row">
Â  Â  Â  Â  <button id="btnEnter">Enter</button>
Â  Â  Â  Â  <button id="btnCancel">Cancel</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</div>

<script>
// Firebase
const firebaseConfig = {
Â  apiKey: "AIzaSyCjivkTeBcbr-UnnkfMbIYX7_9Wxya5U04",
Â  authDomain: "raheim-s-class.firebaseapp.com",
Â  databaseURL: "https://raheim-s-class-default-rtdb.firebaseio.com",
Â  projectId: "raheim-s-class",
Â  storageBucket: "raheim-s-class.firebasestorage.app",
Â  messagingSenderId: "576992270609",
Â  appId: "1:576992270609:web:7441555f9299b8d42bd4b0",
Â  measurementId: "G-MQZ68MPYH3"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

// Vars
const editor=document.getElementById('editor');
const toolbar=document.getElementById('toolbar');
const toggleToolbar=document.getElementById('toggleToolbar');
const chatBox=document.getElementById('chatBox');
const chatInput=document.getElementById('chatInput');
const clearChatBtn=document.getElementById('clearChat');
const reactionCounts=document.getElementById('reactionCounts');
const raisedList=document.getElementById('raisedList');
const permissionList=document.getElementById('permissionList');
const raiseHandBtn=document.getElementById('raiseHand');
const clearHandsBtn=document.getElementById('clearHandsBtn');
const revokeAllBtn=document.getElementById('revokeAllBtn');
const yourPermission=document.getElementById('yourPermission');
let isTeacher=false;
let userRole="Student";
let userName="Student";
const TEACHER_PASSWORD="raheimp100classstarts";

// --- NEW PROFILE EMOJI FUNCTION ---
function getProfileEmoji(userName) {
    if (userName === "Teacher") {
        return "ğŸ‘¨â€ğŸ«"; // Special emoji for the Teacher
    }
    
    // Simple way to get a consistent emoji based on the name's hash
    const baseEmojis = ["âœ¨", "ğŸš€", "ğŸ’¡", "ğŸ§ ", "ğŸŒ±", "ğŸ¦‰", "ğŸ§©", "ğŸŒŸ"];
    const decorations = ["ğŸ’»", "ğŸ“š", "ğŸ“", "ğŸ“", "ğŸ”¬"];
    
    // Use a simple hash (sum of character codes) to pick consistent emojis
    let hash = 0;
    for (let i = 0; i < userName.length; i++) {
        hash += userName.charCodeAt(i);
    }
    
    const base = baseEmojis[hash % baseEmojis.length];
    const deco = decorations[hash % decorations.length];
    
    // Combine them for a unique 'profile' look
    return `${base}${deco}`; 
}
// ------------------------------------

// Notes sync
db.ref('notes').on('value',snap=>{
Â  if(!isTeacher){
Â  Â  const data=snap.val();
Â  Â  if(data) editor.innerHTML=data.content||"";
Â  }
});
editor.addEventListener('input',()=>{
Â  if(isTeacher) db.ref('notes').set({content:editor.innerHTML});
});

// Toolbar
toolbar.querySelectorAll("button[data-symbol]").forEach(btn=>{
Â  btn.onclick=()=>{
Â  Â  if(!isTeacher) return;
Â  Â  editor.innerHTML+=btn.getAttribute("data-symbol");
Â  Â  db.ref('notes').set({content:editor.innerHTML});
Â  };
});
document.getElementById("btnClear").onclick=()=>{
Â  if(isTeacher){editor.innerHTML="";db.ref('notes').set({content:""});}
};
toggleToolbar.onclick=()=>{toolbar.style.display=(toolbar.style.display==="none")?"flex":"none";};

// Chat
db.ref('chat').on('child_added',snap=>{
Â  const msg=snap.val();
Â  const div=document.createElement('div');
Â  // --- MODIFIED: Added profile emoji to chat ---
Â  const profile = getProfileEmoji(msg.userName);
Â  div.innerHTML=`<span style="font-size: 1.1em; color: #4f46e5;">${profile}</span> <b>${msg.userName}:</b> ${msg.text}`;
Â  // --------------------------------------------
Â  chatBox.appendChild(div);
Â  chatBox.scrollTop=chatBox.scrollHeight;
});
function sendChat(){
Â  const input=document.getElementById("chatMessage");
Â  const text=input.value.trim();
Â  if(text!==""){db.ref('chat').push({user:userRole,userName:userName,text:text});input.value="";}
}
document.getElementById("sendChat").onclick=sendChat;
document.getElementById("chatMessage").addEventListener("keypress",e=>{if(e.key==="Enter") sendChat();});
clearChatBtn.onclick=()=>{if(isTeacher){db.ref('chat').set(null);chatBox.innerHTML="";}};

// Emoji picker
const emojiBtn=document.getElementById("emojiBtn");
const emojiPicker=document.getElementById("emojiPicker");
const chatMessage=document.getElementById("chatMessage");
const emojis=["ğŸ˜€","ğŸ˜‚","ğŸ˜","ğŸ˜­","ğŸ˜","ğŸ˜¡","ğŸ‘","ğŸ‘","ğŸ™","ğŸ”¥","ğŸ‰","â­","ğŸ’¯","ğŸ","ğŸ“š","âœï¸","ğŸ§®"];
emojis.forEach(e=>{
Â  const btn=document.createElement("button");
Â  btn.textContent=e;
Â  btn.onclick=()=>{chatMessage.value+=e;emojiPicker.style.display="none";chatMessage.focus();};
Â  emojiPicker.appendChild(btn);
});
emojiBtn.onclick=()=>{emojiPicker.style.display=(emojiPicker.style.display==="none"?"flex":"none");};

// Reactions
db.ref('reactions').on('value',snap=>{
Â  const counts=snap.val()||{};
Â  reactionCounts.innerHTML=Object.entries(counts).map(([emoji,c])=>`${emoji} ${c}`).join(" ");
});
document.querySelectorAll("#reactions button").forEach(btn=>{
Â  btn.onclick=()=>{
Â  Â  const emoji=btn.getAttribute("data-emoji");
Â  Â  db.ref('reactions/'+emoji).transaction(c=>(c||0)+1);
Â  };
});

// Raise hand system
raiseHandBtn.onclick=()=>{db.ref('raisedHands/'+userName).set(true);}

db.ref('raisedHands').on('value',snap=>{
Â  const data=snap.val()||{};
Â  raisedList.innerHTML="";
Â  Object.keys(data).forEach(name=>{
Â  Â  const row=document.createElement("div");
Â  Â  // --- MODIFIED: Added profile emoji to raised hands list ---
Â  Â  const profile = getProfileEmoji(name);
Â  Â  row.innerHTML=`<span style="font-size: 1.1em;">${profile}</span> ${name}`;
Â  Â  // --------------------------------------------------------
Â  Â  if(isTeacher){
Â  Â  Â  const allow=document.createElement("button");
Â  Â  Â  allow.textContent="Allow";
Â  Â  Â  allow.className="allowBtn";
Â  Â  Â  allow.onclick=()=>{db.ref('permissions/'+name).set(true);db.ref('raisedHands/'+name).remove();}
Â  Â  Â  const decline=document.createElement("button");
Â  Â  Â  decline.textContent="Decline";
Â  Â  Â  decline.className="declineBtn";
Â  Â  Â  decline.onclick=()=>{db.ref('raisedHands/'+name).remove();}
Â  Â  Â  row.append(" ",allow," ",decline);
Â  Â  }
Â  Â  raisedList.appendChild(row);
Â  });
});

// Permissions list
db.ref('permissions').on('value',snap=>{
Â  const data=snap.val()||{};
Â  permissionList.innerHTML="";
Â  if(isTeacher){
Â  Â  Object.keys(data).forEach(name=>{
Â  Â  Â  const row=document.createElement("div");
Â  Â  Â  // --- MODIFIED: Added profile emoji to permissions list ---
Â  Â  Â  const profile = getProfileEmoji(name);
Â  Â  Â  row.innerHTML=`<span style="font-size: 1.1em;">${profile}</span> ${name}`;
Â  Â  Â  // ---------------------------------------------------------
Â  Â  Â  const revoke=document.createElement("button");
Â  Â  Â  revoke.textContent="Revoke";
Â  Â  Â  revoke.className="revokeBtn";
Â  Â  Â  revoke.onclick=()=>{db.ref('permissions/'+name).remove();}
Â  Â  Â  row.append(" ",revoke);
Â  Â  Â  permissionList.appendChild(row);
Â  Â  });
Â  } else {
Â  Â  // Students only see their own permission
Â  Â  if(data[userName]){
Â  Â  Â  yourPermission.innerText="âœ… You have board access";
Â  Â  Â  editor.contentEditable="true";
Â  Â  Â  editor.style.border="2px solid green";
Â  Â  } else {
Â  Â  Â  yourPermission.innerText="";
Â  Â  Â  if(!isTeacher){
Â  Â  Â  Â  editor.contentEditable="false";
Â  Â  Â  Â  editor.style.border="none";
Â  Â  Â  }
Â  Â  }
Â  }
});

// Revoke all
revokeAllBtn.onclick=()=>{if(isTeacher) db.ref('permissions').set({});}
clearHandsBtn.onclick=()=>{if(isTeacher) db.ref('raisedHands').set({});}

// Role modal
const roleModal=document.getElementById("roleModal");
document.getElementById("btnTeacher").onclick=()=>{document.getElementById("pwBlock").style.display="block";}
document.getElementById("btnCancel").onclick=()=>{document.getElementById("pwBlock").style.display="none";}
document.getElementById("btnEnter").onclick=()=>{
Â  const pw=document.getElementById("pwInput").value;
Â  if(pw===TEACHER_PASSWORD){
Â  Â  isTeacher=true;userRole="Teacher";userName="Teacher";
Â  Â  toolbar.style.display="flex"; toggleToolbar.style.display="inline-block";
Â  Â  editor.contentEditable="true"; roleModal.style.display="none";
Â  Â  chatInput.style.display="flex"; clearChatBtn.style.display="inline-block";
Â  Â  clearHandsBtn.style.display="inline-block"; revokeAllBtn.style.display="inline-block";
Â  Â  editor.innerHTML="<p>Start typing...</p>";
Â  Â  db.ref('notes').set({content:editor.innerHTML});
Â  } else alert("Wrong password");
};
document.getElementById("btnStudent").onclick=()=>{
Â  userName=prompt("Enter your name:")||"Student";
Â  isTeacher=false;userRole="Student";
Â  editor.contentEditable="false";
Â  toolbar.style.display="none"; toggleToolbar.style.display="none";
Â  roleModal.style.display="none"; chatInput.style.display="flex"; clearChatBtn.style.display="none";
Â  clearHandsBtn.style.display="none"; revokeAllBtn.style.display="none";
};
</script>
</body>
</html>